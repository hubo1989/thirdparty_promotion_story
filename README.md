# 云数汇权益营销平台微信优惠券服务接入项目

## 概述

本项目是云数汇第三方微信优惠券服务接入的完整需求文档和设计资料集合，为合作银行提供统一的微信优惠券发放服务，并在联合营销平台展示相关数据。

## 主要文件

### 需求文档
- **[index.html](index.html)** - 云数汇权益营销平台微信优惠券服务接入需求文档（主文档）
- **[promotion_story.html](promotion_story.html)** - 微信活动管理系统需求文档
- **[activity_story.html](activity_story.html)** - 主题活动需求文档

### 功能原型
- **[promotion_prototype.html](promotion_prototype.html)** - 微信活动管理功能原型
- **[activity_prototype.html](activity_prototype.html)** - 主题活动管理功能原型

### 开发文档
- **[微信活动管理系统开发说明文档.md](微信活动管理系统开发说明文档.md)** - 系统开发技术文档

## 核心功能

### 1. 优惠券服务
- 接入云数汇第三方微信优惠券服务商
- 封装获取openid的H5页面
- 发券、数据回调、数据查询接口

### 2. 接口封装
- 银行请求我方系统接口（发券接口）
- 我方系统调用云数汇接口
- 回调处理接口（异步架构）
- 数据查询接口封装

### 3. 数据管理
- 按活动编码统计发放成功、核销成功数量
- 详细核销记录管理（基于回调接口更新明细状态）
- 详细发放记录管理（基于发放接口返回结果）

### 4. 后台系统
- 联合营销平台查询功能
- 数据权限隔离（基于bankId）
- 操作日志记录与审计

### 5. 主题活动管理系统
- 主题活动创建与配置管理
- 转盘抽奖功能配置（支持240px固定宽度显示，居中对齐）
- 智能筛选功能（关联银行筛选、报名机构下拉选择）
- 活动状态管理与数据统计
- 模态框交互优化（确认操作流程优化）

## 技术架构

### 系统组成
- 云数汇接入层：对接云数汇API
- 业务封装层：封装标准化接口
- 数据存储层：存储发放和核销数据
- 营销平台层：数据展示和权限管理
- 主题活动管理层：活动配置与转盘管理
- 联合营销平台：银行端数据查询

### 技术栈
- 前端：HTML5、CSS3、JavaScript（ES6+）
- 后端：Node.js、Express.js
- 数据库：Supabase（PostgreSQL）
- UI框架：响应式设计、模态框组件
- 开发工具：现代化前端构建工具

### 接口规范
- 请求格式及加密方式遵循云数汇标准
- 支持发放优惠券、核销回调通知、查询发放结果等核心接口
- 异步回调处理机制确保银行系统通知可靠性

## 业务流程

1. **H5获取OpenID**：银行嵌入云数汇h5地址获取用户openid
2. **优惠券发放**：行方系统调用我方系统发放微信优惠券
3. **核销回调通知**：用户使用优惠券时，通过回调机制通知相关系统
4. **数据查询**：支持实时查询发放结果和核销状态

## 部署与维护

### 环境要求
- 现代浏览器支持（Chrome, Firefox, Safari, Edge等）
- 网络连接正常，可访问云数汇API

### 更新日志

#### v2.2.3 (2024-12-19)
- **promotion_story.html 修复状态标签样式和标签页交互功能**
  - 添加状态标签CSS样式定义（status-success绿色、status-danger红色等）
  - 添加标签页CSS样式和交互效果
  - 新增样式效果示例区域，展示状态标签和标签页切换
  - 添加JavaScript标签页切换功能实现
  - 解决状态标签颜色显示和标签页交互问题

#### v2.2.2 (2024-12-19)
- **promotion_story.html 标签页技术说明完善**
  - 添加CSS样式实现的详细表格说明（.tabs、.tab-item等样式类）
  - 补充JavaScript交互逻辑的具体实现步骤（setupTabSwitching函数）
  - 新增HTML结构要求和规范说明（data-tab属性、ID命名规则）
  - 完善交互效果特性的技术细节（过渡动画、视觉反馈）
  - 提供完整的标签页功能开发指导和实现规范

### v2.2.1 (2024-12-19)
- **promotion_story.html 查看功能优化**
  - 修复查看模态框中的标签页切换功能描述
  - 新增活动详情、发放明细、核销明细三个标签页的详细说明
  - 完善标签页内容结构和字段信息展示
  - 添加标签页切换功能的技术实现说明
  - 优化操作流程，增加标签切换和数据操作步骤
  - 提升查看功能的完整性和用户体验描述

#### v2.2.0 (2025年1月)
- **promotion_story.html 文档优化**
  - 采用现代化的视觉风格，与activity_story.html保持一致
  - 更新文档标题为"银行联合营销平台 - 微信活动管理需求说明文档"
  - 重构CSS样式，引入卡片式设计和现代化布局
  - 添加原型预览区域，提供直接链接到promotion_prototype.html
  - 重新组织内容结构：系统概述、查询筛选功能、新增活动功能等
  - 更新字段信息，与promotion_prototype.html的最新调整保持一致
  - 移除时效类型字段，新增通道、渠道、报名机构、面值、使用规则等字段
  - 完善编辑和查看功能描述，明确字段编辑限制
  - 添加批量操作功能和完整的技术规范章节
  - 增加数据字典、API接口规范、性能要求和安全要求

#### v2.1.0 (2025年1月)
- **功能优化**：完善promotion_prototype.html编辑和查看模态框
- **界面简化**：移除时效类型字段，禁用通道和渠道编辑功能
- **交互优化**：简化查看模态框，移除操作信息部分
- **规范统一**：统一字段命名规范（渠道类型→通道，支付渠道→渠道）
- **代码优化**：清理无效JavaScript引用，提升代码质量和性能
- **文档更新**：更新项目文档和配置文件

#### v2.0.0 (2024年12月)
- **核心功能**：完成主题活动管理系统开发
- **原型设计**：完成微信活动管理功能原型
- **接口封装**：完成云数汇第三方服务接入
- **数据管理**：实现优惠券发放和核销数据统计

---
*最后更新：2025年1月*