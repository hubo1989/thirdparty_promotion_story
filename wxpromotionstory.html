<!DOCTYPE html>
<html xmlns:o='urn:schemas-microsoft-com:office:office' 
      xmlns:w='urn:schemas-microsoft-com:office:word' 
      xmlns='http://www.w3.org/TR/REC-html40'>
<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>微信活动需求文档</title>
    <!--[if gte mso 9]>
    <xml>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>90</w:Zoom>
            <w:DoNotPromptForConvert/>
            <w:DoNotShowInsertionsAndDeletions/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <!-- ECharts图表支持 使用多个CDN以确保在中国可访问 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <style>
        body { 
            font-family: '宋体', SimSun, serif; 
            font-size: 14pt; 
            line-height: 1.6; 
            margin: 1in 10% 1in 10%;
            background: white;
        }
        h1 { 
            font-size: 20pt; 
            color: #2c3e50; 
            border-bottom: 2px solid #007bff; 
            padding-bottom: 10pt; 
            margin-top: 20pt;
            margin-bottom: 15pt;
            page-break-after: avoid;
        }
        h2 { 
            font-size: 18pt; 
            color: #007bff; 
            margin-top: 20pt; 
            margin-bottom: 10pt;
            page-break-after: avoid;
        }
        h3 { 
            font-size: 16pt; 
            color: #495057; 
            margin-top: 15pt; 
            margin-bottom: 8pt;
            page-break-after: avoid;
        }
        h4 { 
            font-size: 14pt; 
            color: #6c757d; 
            margin-top: 10pt; 
            margin-bottom: 6pt;
            page-break-after: avoid;
        }
        p { 
            margin-bottom: 6pt; 
            text-align: justify; 
            text-indent: 0;
        }
        ul, ol { 
            margin-left: 20pt; 
            margin-bottom: 10pt;
        }
        li { 
            margin-bottom: 3pt; 
        }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 10pt 0; 
            font-size: 12pt;
        }
        th, td { 
            border: 1pt solid #000; 
            padding: 6pt; 
            text-align: left; 
            vertical-align: top;
        }
        th { 
            background-color: #f0f0f0; 
            font-weight: bold; 
        }
        .code-block { 
            background-color: #f8f9fa; 
            border: 1pt solid #ccc; 
            padding: 10pt; 
            font-family: 'Courier New', monospace; 
            font-size: 12pt;
            margin: 10pt 0;
        }
        .highlight-box { 
            background-color: #e7f3ff; 
            border: 1pt solid #b3d9ff; 
            padding: 10pt; 
            margin: 10pt 0; 
        }
        .warning-box { 
            background-color: #fff3cd; 
            border: 1pt solid #ffeaa7; 
            padding: 10pt; 
            margin: 10pt 0; 
        }
        .success-box { 
            background-color: #d4edda; 
            border: 1pt solid #c3e6cb; 
            padding: 10pt; 
            margin: 10pt 0; 
        }
        .header { 
            text-align: center; 
            margin-bottom: 30pt; 
            border-bottom: 3pt solid #007bff; 
            padding-bottom: 20pt;
        }
        .meta { 
            color: #666; 
            font-size: 12pt; 
            margin-top: 10pt;
        }
        .footer { 
            text-align: center; 
            margin-top: 30pt; 
            border-top: 2pt solid #ccc; 
            padding-top: 20pt; 
            color: #666; 
            font-size: 12pt;
        }
        .api-endpoint { 
            background-color: #28a745; 
            color: white; 
            padding: 4pt 8pt; 
            font-family: 'Courier New', monospace; 
            font-size: 12pt;
        }
        .parameter-list { 
            background-color: #f8f9fa; 
            padding: 8pt; 
            margin: 8pt 0; 
            border-left: 3pt solid #007bff;
        }
        .url-link {
            color: #0066cc;
            text-decoration: underline;
            font-family: 'Courier New', monospace;
            font-size: 12pt;
        }
        /* 图表容器样式 */
        .chart-container {
            position: relative;
            width: 100%;
            min-height: 500px;
            height: auto;
            border: 1px solid #ddd;
            margin: 10pt 0;
        }
        .chart-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            background-color: #f8f9fa;
            color: #666;
            font-style: italic;
        }
        @page {
            margin: 1in 10% 1in 10%;
        }
        @media print {
            body { margin: 1in 10% 1in 10%; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>微信活动需求文档</h1>
    </div>

    <div class="container">
        <div class="content">

           <!-- 1. 功能需求 -->
            <section id="functional-requirements">
                <h2>1. 功能需求</h2>

                <h3>1.1 新增活动</h3>
                
                <h4>1.1.1 功能概述</h4>
                <p>系统应提供新增微信活动的功能，允许管理员创建新的微信优惠券营销活动。新增活动包括填写活动基本信息、配置优惠券规则、设置使用限制等。</p>
                
                <h4>1.1.2 界面设计</h4>
                <p>新增活动功能通过弹出面板实现，包含以下元素：</p>
                <ul>
                    <li><strong>弹出面板</strong>：覆盖整个屏幕，包含表单内容和操作按钮</li>
                    <li><strong>关闭按钮</strong>：右上角"×"按钮，用于关闭面板</li>
                    <li><strong>表单区域</strong>：包含活动信息输入字段</li>
                    <li><strong>操作按钮</strong>：包括"取消"和"确定"按钮</li>
                </ul>
                
                <h4>1.1.3 表单字段</h4>
                <p>新增活动表单应包含以下字段：</p>
                <table>
                    <tr><th>字段名称</th><th>字段类型</th><th>必填</th><th>约束条件</th></tr>
                    <tr>
                        <td>活动名称</td>
                        <td>文本输入框</td>
                        <td>是</td>
                        <td>最大100字符，用于业务识别，不能重复</td>
                    </tr>
                    <tr>
                        <td>主题活动ID</td>
                        <td>文本输入框</td>
                        <td>是</td>
                        <td>关联主题活动表，格式THEME+数字</td>
                    </tr>
                    <tr>
                        <td>批次号</td>
                        <td>文本输入框</td>
                        <td>是</td>
                        <td>9位数字，用于区分同一活动的不同批次</td>
                    </tr>
                    <tr>
                        <td>生效时间</td>
                        <td>日期时间选择器</td>
                        <td>是</td>
                        <td>不能选择过去时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>失效时间</td>
                        <td>日期时间选择器</td>
                        <td>是</td>
                        <td>必须晚于生效时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>优惠券类型</td>
                        <td>单选按钮组</td>
                        <td>是</td>
                        <td>可选：满减券、折扣券、代金券</td>
                    </tr>
                    <tr>
                        <td>优惠金额</td>
                        <td>数值输入框</td>
                        <td>是</td>
                        <td>最多支持小数点后2位</td>
                    </tr>
                    <tr>
                        <td>使用门槛</td>
                        <td>数值输入框</td>
                        <td>否</td>
                        <td>最多支持小数点后2位，0表示无门槛</td>
                    </tr>
                    <tr>
                        <td>使用周期</td>
                        <td>单选按钮组</td>
                        <td>是</td>
                        <td>可选：固定天数、指定日期范围</td>
                    </tr>
                    <tr>
                        <td>结算方式</td>
                        <td>单选按钮组</td>
                        <td>是</td>
                        <td>可选：银行承担、商户承担、按比例承担</td>
                    </tr>
                    <tr>
                        <td>结算比例</td>
                        <td>数值输入框</td>
                        <td>条件</td>
                        <td>当结算方式为按比例承担时必填，最多支持小数点后2位</td>
                    </tr>
                </table>
                
                <h4>1.1.4 表单验证规则</h4>
                <ul>
                    <li>必填字段需标记红色星号，提交前必须填写</li>
                    <li>数字字段支持小数点后2位</li>
                    <li>日期字段不能选择过去时间</li>
                    <li>文本字段有长度限制和字符计数</li>
                    <li>失效时间必须晚于生效时间</li>
                    <li>当结算方式为按比例承担时，结算比例为必填</li>
                </ul>
                
                <h4>1.1.5 操作流程</h4>
                <ol>
                    <li>用户点击"新增活动"按钮</li>
                    <li>系统显示新增活动弹出面板</li>
                    <li>用户填写活动信息</li>
                    <li>用户点击"确定"按钮</li>
                    <li>系统验证表单数据</li>
                    <li>如验证通过，系统保存活动信息并关闭面板</li>
                    <li>如验证失败，系统显示错误提示信息</li>
                </ol>
                
                <h3>1.2 编辑活动</h3>
                
                <h4>1.2.1 功能概述</h4>
                <p>系统应提供编辑微信活动的功能，允许管理员修改已创建的微信优惠券营销活动。只有状态为"待开始"和"进行中"的活动可以编辑。</p>
                
                <h4>1.2.2 界面设计</h4>
                <p>编辑活动功能通过弹出面板实现，包含以下元素：</p>
                <ul>
                    <li><strong>弹出面板</strong>：覆盖整个屏幕，包含表单内容和操作按钮</li>
                    <li><strong>关闭按钮</strong>：右上角"×"按钮，用于关闭面板</li>
                    <li><strong>表单区域</strong>：包含活动信息输入字段，已存在的信息需预填充</li>
                    <li><strong>操作按钮</strong>：包括"取消"和"确定"按钮</li>
                </ul>
                
                <h4>1.2.3 表单字段</h4>
                <p>编辑活动表单应包含以下字段（与新增活动表单相同）：</p>
                <table>
                    <tr><th>字段名称</th><th>字段类型</th><th>必填</th><th>约束条件</th></tr>
                    <tr>
                        <td>活动名称</td>
                        <td>文本输入框</td>
                        <td>是</td>
                        <td>最大100字符，用于业务识别，不能重复</td>
                    </tr>
                    <tr>
                        <td>主题活动ID</td>
                        <td>文本输入框</td>
                        <td>是</td>
                        <td>关联主题活动表，格式THEME+数字（只读）</td>
                    </tr>
                    <tr>
                        <td>批次号</td>
                        <td>文本输入框</td>
                        <td>是</td>
                        <td>9位数字，用于区分同一活动的不同批次（只读）</td>
                    </tr>
                    <tr>
                        <td>生效时间</td>
                        <td>日期时间选择器</td>
                        <td>是</td>
                        <td>不能选择过去时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>失效时间</td>
                        <td>日期时间选择器</td>
                        <td>是</td>
                        <td>必须晚于生效时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>优惠券类型</td>
                        <td>单选按钮组</td>
                        <td>是</td>
                        <td>可选：满减券、折扣券、代金券</td>
                    </tr>
                    <tr>
                        <td>优惠金额</td>
                        <td>数值输入框</td>
                        <td>是</td>
                        <td>最多支持小数点后2位</td>
                    </tr>
                    <tr>
                        <td>使用门槛</td>
                        <td>数值输入框</td>
                        <td>否</td>
                        <td>最多支持小数点后2位，0表示无门槛</td>
                    </tr>
                    <tr>
                        <td>使用周期</td>
                        <td>单选按钮组</td>
                        <td>是</td>
                        <td>可选：固定天数、指定日期范围</td>
                    </tr>
                    <tr>
                        <td>结算方式</td>
                        <td>单选按钮组</td>
                        <td>是</td>
                        <td>可选：银行承担、商户承担、按比例承担</td>
                    </tr>
                    <tr>
                        <td>结算比例</td>
                        <td>数值输入框</td>
                        <td>条件</td>
                        <td>当结算方式为按比例承担时必填，最多支持小数点后2位</td>
                    </tr>
                </table>
                
                <h4>1.2.4 表单验证规则</h4>
                <ul>
                    <li>必填字段需标记红色星号，提交前必须填写</li>
                    <li>数字字段支持小数点后2位</li>
                    <li>日期字段不能选择过去时间</li>
                    <li>文本字段有长度限制和字符计数</li>
                    <li>失效时间必须晚于生效时间</li>
                    <li>当结算方式为按比例承担时，结算比例为必填</li>
                    <li>主题活动ID和批次号为只读字段，不可修改</li>
                </ul>
                
                <h4>1.2.5 操作流程</h4>
                <ol>
                    <li>用户在活动列表中点击某活动的"编辑"按钮</li>
                    <li>系统显示编辑活动弹出面板，并预填充该活动的现有信息</li>
                    <li>用户修改活动信息</li>
                    <li>用户点击"确定"按钮</li>
                    <li>系统验证表单数据</li>
                    <li>如验证通过，系统更新活动信息并关闭面板</li>
                    <li>如验证失败，系统显示错误提示信息</li>
                </ol>
                
                <h4>1.2.6 权限控制</h4>
                <ul>
                    <li>只有状态为"待开始"和"进行中"的活动可以编辑</li>
                    <li>用户需要具有编辑权限才能执行此操作</li>
                </ul>
                
                <h3>1.3 查看活动详情</h3>
                
                <h4>1.3.1 功能概述</h4>
                <p>系统应提供查看微信活动详情的功能，允许用户查看活动的完整信息，包括基本信息、发放明细和核销明细。所有状态的活动都可以查看。</p>
                
                <h4>1.3.2 界面设计</h4>
                <p>查看活动详情功能通过弹出面板实现，包含以下元素：</p>
                <ul>
                    <li><strong>弹出面板</strong>：宽度为屏幕的90%，最大宽度1200px，高度为全屏，支持滚动</li>
                    <li><strong>关闭按钮</strong>：右上角"×"按钮，用于关闭面板</li>
                    <li><strong>标签页</strong>：包含"活动详情"、"发放明细"、"核销明细"三个标签页</li>
                    <li><strong>活动详情标签页</strong>：显示活动的基本信息</li>
                    <li><strong>发放明细标签页</strong>：以表格形式显示该活动的所有发放记录</li>
                    <li><strong>核销明细标签页</strong>：以表格形式显示该活动的所有核销记录</li>
                </ul>
                
                <h4>1.3.3 活动详情标签页</h4>
                <p>活动详情标签页显示以下信息：</p>
                <table>
                    <tr><th>字段名称</th><th>显示内容</th></tr>
                    <tr>
                        <td>活动ID</td>
                        <td>32位UUID，系统自动生成的唯一标识</td>
                    </tr>
                    <tr>
                        <td>活动名称</td>
                        <td>用户定义的活动名称</td>
                    </tr>
                    <tr>
                        <td>主题活动ID</td>
                        <td>关联的主题活动ID</td>
                    </tr>
                    <tr>
                        <td>批次号</td>
                        <td>9位数字批次号</td>
                    </tr>
                    <tr>
                        <td>生效时间</td>
                        <td>活动开始时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>失效时间</td>
                        <td>活动结束时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>创建时间</td>
                        <td>活动创建时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>更新时间</td>
                        <td>活动最后更新时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>活动状态</td>
                        <td>活动当前状态（待开始、进行中、已终止、已结束）</td>
                    </tr>
                    <tr>
                        <td>创建人</td>
                        <td>创建该活动的用户</td>
                    </tr>
                    <tr>
                        <td>更新人</td>
                        <td>最后更新该活动的用户</td>
                    </tr>
                </table>
                
                <h4>1.3.4 发放明细标签页</h4>
                <p>发放明细标签页以表格形式显示该活动的所有发放记录，包含以下字段：</p>
                <table>
                    <tr><th>字段名称</th><th>说明</th></tr>
                    <tr>
                        <td>发券流水号</td>
                        <td>发放优惠券的唯一标识</td>
                    </tr>
                    <tr>
                        <td>活动ID</td>
                        <td>关联的活动ID</td>
                    </tr>
                    <tr>
                        <td>OpenID</td>
                        <td>用户微信OpenID</td>
                    </tr>
                    <tr>
                        <td>优惠券类型</td>
                        <td>优惠券类型（满减券、折扣券、代金券）</td>
                    </tr>
                    <tr>
                        <td>优惠金额</td>
                        <td>优惠券的优惠金额</td>
                    </tr>
                    <tr>
                        <td>使用门槛</td>
                        <td>使用该优惠券的最低消费金额</td>
                    </tr>
                    <tr>
                        <td>发放时间</td>
                        <td>优惠券发放时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>优惠券状态</td>
                        <td>优惠券当前状态（未使用、已使用、已过期）</td>
                    </tr>
                </table>
                
                <h4>1.3.5 核销明细标签页</h4>
                <p>核销明细标签页以表格形式显示该活动的所有核销记录，包含以下字段：</p>
                <table>
                    <tr><th>字段名称</th><th>说明</th></tr>
                    <tr>
                        <td>发券流水号</td>
                        <td>发放优惠券的唯一标识</td>
                    </tr>
                    <tr>
                        <td>交易流水号</td>
                        <td>核销交易的唯一标识</td>
                    </tr>
                    <tr>
                        <td>活动ID</td>
                        <td>关联的活动ID</td>
                    </tr>
                    <tr>
                        <td>OpenID</td>
                        <td>用户微信OpenID</td>
                    </tr>
                    <tr>
                        <td>优惠券类型</td>
                        <td>优惠券类型（满减券、折扣券、代金券）</td>
                    </tr>
                    <tr>
                        <td>核销金额</td>
                        <td>实际核销的优惠金额</td>
                    </tr>
                    <tr>
                        <td>订单金额</td>
                        <td>用户实际支付的订单金额</td>
                    </tr>
                    <tr>
                        <td>商户编号</td>
                        <td>核销商户的编号</td>
                    </tr>
                    <tr>
                        <td>商户名称</td>
                        <td>核销商户的名称</td>
                    </tr>
                    <tr>
                        <td>核销时间</td>
                        <td>优惠券核销时间，格式YYYY-MM-DD HH:mm:ss</td>
                    </tr>
                    <tr>
                        <td>核销状态</td>
                        <td>核销状态（核销成功、核销失败）</td>
                    </tr>
                </table>
                
                <h4>1.3.6 操作流程</h4>
                <ol>
                    <li>用户在活动列表中点击某活动的"查看"按钮</li>
                    <li>系统显示查看活动详情弹出面板，默认显示活动详情标签页</li>
                    <li>用户可以通过点击标签页切换到发放明细或核销明细</li>
                    <li>用户点击关闭按钮关闭面板</li>
                </ol>
                
                <h4>1.3.7 权限控制</h4>
                <ul>
                    <li>所有状态的活动都可以查看</li>
                    <li>查看为只读模式，不允许修改任何信息</li>
                    <li>用户需要具有查看权限才能执行此操作</li>
                </ul>
                
                <h3>1.4 活动状态管理</h3>
                <div id="activity-status-chart" class="chart-container">
                    <div class="chart-placeholder">图表加载中...</div>
                </div>
                <script>
                    function initActivityStatusChart() {
                        var chartDom = document.getElementById('activity-status-chart');
                        if (!chartDom) return;
                        
                        // 检查ECharts是否加载成功
                        if (typeof echarts === 'undefined') {
                            chartDom.innerHTML = '<div class="chart-placeholder">图表库加载失败，请刷新页面重试</div>';
                            return;
                        }
                        
                        try {
                            // 清空容器内容
                            chartDom.innerHTML = '';
                            
                            var myChart = echarts.init(chartDom);
                            
                            myChart.setOption({
                                title: {
                                    text: '活动状态流转图'
                                },
                                series: [{
                                    type: 'graph',
                                    layout: 'force',
                                    symbolSize: 50,
                                    roam: false, // 禁用缩放和漫游
                                    focusNodeAdjacency: true,
                                    draggable: false, // 禁用节点拖拽
                                    force: {
                                        repulsion: 1000,
                                        edgeLength: [50, 100]
                                    },
                                    label: {
                                        show: true
                                    },
                                    edgeSymbol: ['circle', 'arrow'],
                                    edgeSymbolSize: [4, 10],
                                    data: [{
                                        name: '待开始',
                                        itemStyle: { color: '#66CCFF' }
                                    }, {
                                        name: '进行中',
                                        itemStyle: { color: '#66FF66' }
                                    }, {
                                        name: '已终止',
                                        itemStyle: { color: '#FF6666' }
                                    }, {
                                        name: '已结束',
                                        itemStyle: { color: '#CCCCCC' }
                                    }],
                                    links: [{
                                        source: '待开始',
                                        target: '进行中'
                                    }, {
                                        source: '进行中',
                                        target: '已终止',
                                        lineStyle: { width: 2 },
                                        label: { show: true, formatter: '手动终止' }
                                    }, {
                                        source: '进行中',
                                        target: '已结束',
                                        lineStyle: { width: 2 },
                                        label: { show: true, formatter: '时间到达' }
                                    }],
                                    lineStyle: {
                                        opacity: 0.9,
                                        width: 2,
                                        curveness: 0
                                    }
                                }]
                            });
                            
                            // 监听窗口大小变化，自适应图表
                            window.addEventListener('resize', function() {
                                myChart.resize();
                            });
                        } catch (e) {
                            chartDom.innerHTML = '<div class="chart-placeholder">图表初始化失败: ' + e.message + '</div>';
                        }
                    }
                    
                    // 确保DOM加载完成后初始化图表
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', function() {
                            // 延迟执行以确保ECharts完全加载
                            setTimeout(initActivityStatusChart, 100);
                        });
                    } else {
                        setTimeout(initActivityStatusChart, 100);
                    }
                    
                    // 添加图表初始化检查函数
                    function checkActivityStatusChart() {
                        var chartDom = document.getElementById('activity-status-chart');
                        if (chartDom && chartDom.innerHTML.includes('图表加载中')) {
                            initActivityStatusChart();
                        }
                    }
                </script>

                <!-- 
                    操作权限控制表
                    描述了不同用户角色对活动管理功能的访问权限
                    权限基于控制台用户角色可配置
                -->
                <h3>1.3 操作权限控制</h3>
                <!-- 
                    权限矩阵表
                    展示了管理员、操作员和审计员三种角色对系统功能的访问权限
                    ✓ 表示有权限，✗ 表示无权限
                    权限控制基于控制台用户角色配置，支持灵活调整
                -->
                <table>
                    <tr><th>角色</th><th>查看</th><th>创建</th><th>编辑</th><th>终止</th></tr>
                    <tr>
                        <td>管理员</td>
                        <td>✓</td>
                        <td>✓</td>
                        <td>✓</td>
                        <td>✓</td>
                    </tr>
                    <tr>
                        <td>操作员</td>
                        <td>✓</td>
                        <td>✓</td>
                        <td>✓</td>
                        <td>✗</td>
                    </tr>
                    <tr>
                        <td>审计员</td>
                        <td>✓</td>
                        <td>✗</td>
                        <td>✗</td>
                        <td>✗</td>
                    </tr>
                </table>
            </section>

            <!-- 2. 界面设计 -->
            <section id="ui-design">
                <h2>2. 界面设计</h2>
                
                <h3>2.1 产品原型预览</h3>
                <p>以下是微信活动管理系统的界面原型预览，展示了主要功能界面和交互设计：</p>
                <button style="background-color: #4a90e2; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;" onclick="window.location.href='wxpromotionprototype.html'">
                    查看完整原型
                </button>
                <div style="text-align: center;">
                    <img src="wxprototype.png" alt="产品原型预览" style="max-width: 100%; height: auto;">
                </div>

                <h3>2.2 操作流程图</h3>
                <div id="operation-flow-chart" class="chart-container">
                    <div class="chart-placeholder">图表加载中...</div>
                </div>
                <script>
                    function initOperationFlowChart() {
                        var chartDom = document.getElementById('operation-flow-chart');
                        if (!chartDom) {
                            console.log('操作流程图容器未找到');
                            return;
                        }
                        
                        // 检查ECharts是否加载成功
                        if (typeof echarts === 'undefined') {
                            chartDom.innerHTML = '<div class="chart-placeholder">图表库加载失败，请刷新页面重试</div>';
                            console.log('ECharts库未加载');
                            return;
                        }
                        
                        try {
                            // 清空容器内容
                            chartDom.innerHTML = '';
                            
                            var myChart = echarts.init(chartDom);
                            
                            myChart.setOption({
                                title: {
                                    text: '操作流程图'
                                },
                                series: [{
                                    type: 'graph',
                                    layout: 'force',
                                    symbolSize: 60,
                                    roam: false, // 禁用缩放和漫游
                                    focusNodeAdjacency: true,
                                    draggable: false, // 禁用节点拖拽
                                    force: {
                                        repulsion: 1000,
                                        edgeLength: [50, 100]
                                    },
                                    label: {
                                        show: true
                                    },
                                    edgeSymbol: ['circle', 'arrow'],
                                    edgeSymbolSize: [4, 10],
                                    data: [{
                                        name: '创建活动',
                                        itemStyle: { color: '#66CCFF' }
                                    }, {
                                        name: '待生效',
                                        itemStyle: { color: '#FF9966' }
                                    }, {
                                        name: '编辑活动',
                                        itemStyle: { color: '#FF9966' }
                                    }, {
                                        name: '生效中',
                                        itemStyle: { color: '#66FF66' }
                                    }, {
                                        name: '已终止',
                                        itemStyle: { color: '#CCCCCC' }
                                    }],
                                    links: [{
                                        source: '创建活动',
                                        target: '待生效'
                                    }, {
                                        source: '待生效',
                                        target: '生效中'
                                    }, {
                                        source: '生效中',
                                        target: '编辑活动'
                                    }, {
                                        source: '编辑活动',
                                        target: '待生效'
                                    }, {
                                        source: '生效中',
                                        target: '已终止',
                                        lineStyle: { width: 2 },
                                        label: { show: true, formatter: '手动终止' }
                                    }],
                                    lineStyle: {
                                        opacity: 0.9,
                                        width: 2,
                                        curveness: 0
                                    }
                                }]
                            });
                            
                            // 监听窗口大小变化，自适应图表
                            window.addEventListener('resize', function() {
                                myChart.resize();
                            });
                            
                            console.log('操作流程图初始化成功');
                        } catch (e) {
                            chartDom.innerHTML = '<div class="chart-placeholder">图表初始化失败: ' + e.message + '</div>';
                            console.error('操作流程图初始化失败:', e);
                        }
                    }
                    
                    // 确保DOM加载完成后初始化图表
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', function() {
                            // 延迟执行以确保ECharts完全加载
                            setTimeout(initOperationFlowChart, 100);
                        });
                    } else {
                        setTimeout(initOperationFlowChart, 100);
                    }
                    
                    // 添加图表初始化检查函数
                    function checkOperationFlowChart() {
                        var chartDom = document.getElementById('operation-flow-chart');
                        if (chartDom && chartDom.innerHTML.includes('图表加载中')) {
                            console.log('重新尝试初始化操作流程图');
                            initOperationFlowChart();
                        }
                    }
                </script>
                
            </section>

            <!-- 3. 数据规范 -->
            <section id="data-spec">
                <h2>3. 数据规范</h2>
                
                <h3>3.1 数据字典</h3>
                <table>
                    <tr><th>字段</th><th>类型</th><th>描述</th><th>约束</th></tr>
                    <tr>
                        <td>activityId</td>
                        <td>string</td>
                        <td>活动唯一标识</td>
                        <td>32位UUID</td>
                    </tr>
                    <tr>
                        <td>effectiveTime</td>
                        <td>datetime</td>
                        <td>生效时间</td>
                        <td>未来6个月内</td>
                    </tr>
                </table>

                <h3>3.2 时间规范</h3>
                <ul>
                    <li>时间格式：ISO 8601（YYYY-MM-DDTHH:mm:ssZ）</li>
                    <li>时区：UTC+8</li>
                    <li>时间精度：秒级</li>
                </ul>
            </section>

            <!-- 4. 非功能需求 -->
            <section id="non-func">
                <h2>4. 非功能需求</h2>
                
                <h3>4.1 性能指标</h3>
                <table>
                    <tr><th>指标</th><th>要求</th></tr>
                    <tr><td>并发处理</td><td>≥1000 TPS</td></tr>
                    <tr><td>响应时间</td><td>≤500ms（P95）</td></tr>
                </table>

                <h3>4.2 安全要求</h3>
                <ul>
                    <li>敏感数据加密存储（AES-256）</li>
                    <li>操作日志保留36个月</li>
                    <li>权限粒度控制到字段级别</li>
                </ul>
            </section>

          

            
        </div>
    </div>

    <script>hljs.highlightAll();</script>
    
    <!-- ECharts备用加载方案 -->
    <script>
        // 检查是否所有图表都已成功初始化
        function checkAndInitCharts() {
            // 检查各个图表是否需要重新初始化
            var systemChart = document.getElementById('system-architecture-chart');
            var operationChart = document.getElementById('operation-flow-chart');
            
            // 如果图表容器中仍有"加载中"提示，说明初始化失败
            if (systemChart && systemChart.innerHTML.includes('图表加载中')) {
                setTimeout(initSystemArchitectureChart, 100);
            }
            
            if (operationChart && operationChart.innerHTML.includes('图表加载中')) {
                setTimeout(initOperationFlowChart, 100);
            }
        }
        
        // 如果主CDN加载失败，尝试备用方案
        if (typeof echarts === 'undefined') {
            console.log('ECharts未定义，尝试加载备用CDN');
            // 创建script元素加载备用CDN
            var script = document.createElement('script');
            script.src = 'https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js';
            script.onload = function() {
                console.log('ECharts备用CDN加载成功');
                // 重新初始化所有图表
                setTimeout(function() {
                    initActivityStatusChart();
                    initSystemArchitectureChart();
                    initOperationFlowChart();
                }, 200);
            };
            script.onerror = function() {
                // 如果备用CDN也失败，使用本地fallback方案
                console.log('ECharts加载失败，使用备用方案');
                document.querySelectorAll('.chart-container').forEach(function(container) {
                    if (container.innerHTML.includes('图表加载中')) {
                        container.innerHTML = '<div class="chart-placeholder">图表库加载失败，请检查网络连接后刷新页面重试</div>';
                    }
                });
            };
            document.head.appendChild(script);
        } else {
            // ECharts已加载，但某些图表可能未正确初始化，检查并重新初始化
            console.log('ECharts已加载，检查各图表初始化状态');
            setTimeout(function() {
                checkActivityStatusChart();
                checkSystemArchitectureChart();
                checkOperationFlowChart();
            }, 500);
        }
    </script>
</body>
</html>