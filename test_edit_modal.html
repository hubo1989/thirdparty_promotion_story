<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼–è¾‘æ¨¡æ€æ¡†æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background-color: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background-color: #337ecc;
        }
        .status {
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #f0f9ff;
            border: 1px solid #67c23a;
            color: #67c23a;
        }
        .error {
            background-color: #fef0f0;
            border: 1px solid #f56c6c;
            color: #f56c6c;
        }
        .info {
            background-color: #f4f4f5;
            border: 1px solid #909399;
            color: #606266;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ç¼–è¾‘æ¨¡æ€æ¡†åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="status info">
            <strong>æµ‹è¯•è¯´æ˜ï¼š</strong>
            <ul>
                <li>ç‚¹å‡»ä¸‹é¢çš„æµ‹è¯•æŒ‰é’®æ¥éªŒè¯ç¼–è¾‘æ¨¡æ€æ¡†åŠŸèƒ½</li>
                <li>æ£€æŸ¥æ˜¯å¦è¿˜æœ‰JavaScripté”™è¯¯</li>
                <li>éªŒè¯æ¨¡æ€æ¡†æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º</li>
                <li>æ£€æŸ¥é€‰æ‹©å™¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</li>
            </ul>
        </div>
        
        <button class="test-button" onclick="testEditModal()">æµ‹è¯•ç¼–è¾‘æ¨¡æ€æ¡†</button>
        <button class="test-button" onclick="testJavaScriptErrors()">æ£€æŸ¥JavaScripté”™è¯¯</button>
        <button class="test-button" onclick="openOriginalPage()">æ‰“å¼€åŸå§‹é¡µé¢</button>
        
        <div id="testResults"></div>
        
        <div class="status info">
            <strong>ä¿®å¤å†…å®¹ï¼š</strong>
            <ul>
                <li>âœ… æ·»åŠ äº† editSelectedInstitutions å’Œ editSelectedBanks å®¹å™¨å…ƒç´ </li>
                <li>âœ… å®ç°äº†ç¼–è¾‘æ¨¡æ€æ¡†ä¸“ç”¨çš„é€‰æ‹©å™¨å‡½æ•°</li>
                <li>âœ… ä¿®å¤äº† loadEditData å‡½æ•°çš„ null å¼•ç”¨é”™è¯¯</li>
                <li>âœ… ä¿®å¤äº†ç¼–è¾‘æŒ‰é’®ç‚¹å‡»åæ¨¡æ€æ¡†ç«‹å³å…³é—­çš„é—®é¢˜</li>
                <li>âœ… ç¡®ä¿ç¼–è¾‘æ¨¡æ€æ¡†èƒ½æ­£å¸¸æ˜¾ç¤ºå’Œæ“ä½œ</li>
            </ul>
        </div>
    </div>
    
    <script>
        function testEditModal() {
            const resultsDiv = document.getElementById('testResults');
            
            try {
                // æµ‹è¯•æ˜¯å¦èƒ½è®¿é—®ç¼–è¾‘æ¨¡æ€æ¡†ç›¸å…³çš„DOMå…ƒç´ 
                const tests = [
                    { name: 'ç¼–è¾‘æ¨¡æ€æ¡†å…ƒç´ ', test: () => !!document.querySelector('#editActivityModal') },
                    { name: 'editSelectedInstitutionså…ƒç´ ', test: () => !!document.querySelector('#editSelectedInstitutions') },
                    { name: 'editSelectedBankså…ƒç´ ', test: () => !!document.querySelector('#editSelectedBanks') },
                    { name: 'showEditActivityModalå‡½æ•°', test: () => typeof showEditActivityModal === 'function' },
                    { name: 'loadEditDataå‡½æ•°', test: () => typeof loadEditData === 'function' },
                    { name: 'addSelectedInstitutionEditå‡½æ•°', test: () => typeof addSelectedInstitutionEdit === 'function' },
                    { name: 'addSelectedBankEditå‡½æ•°', test: () => typeof addSelectedBankEdit === 'function' }
                ];
                
                let results = '<div class="status success"><h3>æµ‹è¯•ç»“æœï¼š</h3><ul>';
                let allPassed = true;
                
                tests.forEach(test => {
                    try {
                        const passed = test.test();
                        results += `<li>${test.name}: ${passed ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}</li>`;
                        if (!passed) allPassed = false;
                    } catch (e) {
                        results += `<li>${test.name}: âŒ é”™è¯¯ - ${e.message}</li>`;
                        allPassed = false;
                    }
                });
                
                results += '</ul>';
                if (allPassed) {
                    results += '<p><strong>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç¼–è¾‘æ¨¡æ€æ¡†åŠŸèƒ½å·²ä¿®å¤ã€‚</strong></p>';
                } else {
                    results += '<p><strong>âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ã€‚</strong></p>';
                }
                results += '</div>';
                
                resultsDiv.innerHTML = results;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error"><h3>æµ‹è¯•å¤±è´¥ï¼š</h3><p>${error.message}</p></div>`;
            }
        }
        
        function testJavaScriptErrors() {
            const resultsDiv = document.getElementById('testResults');
            
            // ç›‘å¬JavaScripté”™è¯¯
            let errorCount = 0;
            const originalError = window.onerror;
            
            window.onerror = function(message, source, lineno, colno, error) {
                errorCount++;
                console.error('JavaScript Error:', { message, source, lineno, colno, error });
                if (originalError) originalError.apply(this, arguments);
            };
            
            // å°è¯•æ‰§è¡Œä¸€äº›å¯èƒ½å‡ºé”™çš„æ“ä½œ
            try {
                // æ¨¡æ‹Ÿè°ƒç”¨ç¼–è¾‘æ¨¡æ€æ¡†ç›¸å…³å‡½æ•°
                if (typeof loadEditData === 'function') {
                    loadEditData([], []);
                }
                
                setTimeout(() => {
                    if (errorCount === 0) {
                        resultsDiv.innerHTML = '<div class="status success"><h3>JavaScripté”™è¯¯æ£€æŸ¥ï¼š</h3><p>âœ… æœªå‘ç°JavaScripté”™è¯¯</p></div>';
                    } else {
                        resultsDiv.innerHTML = `<div class="status error"><h3>JavaScripté”™è¯¯æ£€æŸ¥ï¼š</h3><p>âŒ å‘ç° ${errorCount} ä¸ªé”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°</p></div>`;
                    }
                    
                    // æ¢å¤åŸå§‹é”™è¯¯å¤„ç†
                    window.onerror = originalError;
                }, 1000);
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error"><h3>JavaScripté”™è¯¯æ£€æŸ¥ï¼š</h3><p>âŒ æ‰§è¡Œæµ‹è¯•æ—¶å‡ºé”™ï¼š${error.message}</p></div>`;
            }
        }
        
        function openOriginalPage() {
            window.open('activity_prototype.html', '_blank');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
        window.addEventListener('load', function() {
            // å»¶è¿Ÿä¸€ä¸‹ç¡®ä¿æ‰€æœ‰è„šæœ¬éƒ½åŠ è½½å®Œæˆ
            setTimeout(() => {
                // æ£€æŸ¥æ˜¯å¦åœ¨iframeä¸­ï¼ˆå¦‚æœæ˜¯ï¼Œè¯´æ˜å¯èƒ½åœ¨åŸå§‹é¡µé¢çš„ä¸Šä¸‹æ–‡ä¸­ï¼‰
                if (window.parent !== window) {
                    testEditModal();
                }
            }, 500);
        });
    </script>
    
    <!-- åŠ è½½åŸå§‹é¡µé¢çš„è„šæœ¬æ¥æµ‹è¯•åŠŸèƒ½ -->
    <iframe src="activity_prototype.html" style="display: none;" onload="setTimeout(testEditModal, 1000)"></iframe>
</body>
</html>